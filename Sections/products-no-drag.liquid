{% assign tab_names = "just-in,top-picks,on-sale" | split: "," %}

<section class="products-section">
  <div class="products-header">
    <h2 class="products-title">PRODUCTS</h2>
    <p class="products-subtitle">Best-Selling Pet Products Loved by Pet Parents</p>
  </div>

  <!-- Tabs -->
  <div class="products-tabs">
    <button class="tab-button active" data-tab="just-in">Just In</button>
    <button class="tab-button" data-tab="top-picks">Top Picks</button>
    <button class="tab-button" data-tab="on-sale">On Sale</button>
  </div>

  <!-- Product Carousels by Tab -->
  <button class="carousel-arrow prev">&larr;</button>
  <div class="products-carousels">
    {% for tab in tab_names %}
      <div class="products-carousel-wrapper"
           data-tab="{{ tab }}"
           {% unless tab == "just-in" %}style="display:none"{% endunless %}>

        <div class="products-carousel">
          {% for block in section.blocks %}
            {% if block.settings.tab == tab %}
              {% assign product = all_products[block.settings.product_item] %}
              {% if product %}
                <div class="product-card">
                  <a href="{{ product.url }}">
                    <div class="product-image-wrapper">
                      <img src="{{ block.settings.product_image | image_url: width: 600, height: 600, crop: 'center' }}" alt="{{ product.title }}">
                      {% if block.settings.hover_image %}
                        <img class="product-image hover-image" src="{{ block.settings.hover_image | image_url: width: 600, height: 600, crop: 'center' }}" alt="{{ product.title }} hover">
                      {% endif %}
                    </div>
                    <div class="product-info">
                      <div class="product-title">{{ product.title }}</div>
                      <div class="product-price">
                        {% if product.compare_at_price > product.price %}
                          <span class="original-price" style="text-decoration: line-through; color: #999;">{{ product.compare_at_price | money }}</span>
                          <span class="sale-price" style="color: red; margin-left: 0.5rem;">{{ product.price | money }}</span>
                        {% else %}
                          {{ product.price | money }}
                        {% endif %}
                      </div>
                    </div>
                  </a>
                </div>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
  <button class="carousel-arrow next">&rarr;</button>
</section>

{% schema %}
{
  "name": "Products",
  "settings": [],
  "blocks": [
    {
      "type": "product",
      "name": "Product Card",
      "settings": [
        {
          "type": "select",
          "id": "tab",
          "label": "Category",
          "options": [
            { "value": "just-in", "label": "Just In" },
            { "value": "top-picks", "label": "Top Picks" },
            { "value": "on-sale", "label": "On Sale" }
          ],
          "default": "just-in"
        },
        {
          "type": "product",
          "id": "product_item",
          "label": "Select Product"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product Image"
        },
        {
          "type": "image_picker",
          "id": "hover_image",
          "label": "Hover Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Products",
      "blocks": []
    }
  ]
}
{% endschema %}
